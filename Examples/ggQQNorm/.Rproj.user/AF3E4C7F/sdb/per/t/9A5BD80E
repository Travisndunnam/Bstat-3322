{
    "contents" : "---\ntitle: \"Assessing normality with norma Quantile-Quantile  plots\"\nauthor: \"by Craig W. Slinkman\"\ndate: \"November 15, 2015\"\noutput: word_document\n---\n\nAn important aspect of analyzing data is to determine if a variable is approximately normally distributed.  It is advantageous if the data is normally distributed because there are a wide number of statistical procedures that require  the variables of interest be normally distributed.\n\n# Basic theory\nIn statistics, a Q-Q plot[1] (\"Q\" stands for quantile) is a probability plot, which is a graphical method for comparing two probability distributions by plotting their quantiles against each other. First, the set of intervals for the quantiles is chosen. A point (x, y) on the plot corresponds to one of the quantiles of the second distribution (y-coordinate) plotted against the same quantile of the first distribution (x-coordinate). Thus the line is a parametric curve with the parameter which is the (number of the) interval for the quantile.\n\nIf the two distributions being compared are similar, the points in the Q-Q plot will approximately lie on the line y = x. If the distributions are linearly related, the points in the Q-Q plot will approximately lie on a line, but not necessarily on the line y = x. Q-Q plots can also be used as a graphical means of estimating parameters in a location-scale family of distributions.\n\nA Quantile-Quantile (QQ) plot is used to compare the shapes of distributions, providing a graphical view of how properties such as location, scale, and skewness are similar or different in the two distributions. QQ plots can be used to compare collections of data, or theoretical distributions. The use of QQ plots to compare two samples of data can be viewed as a non-parametric approach to comparing their underlying distributions. \n\nA QQ plot is generally a more powerful approach to do this than the common technique of comparing histograms of the two samples, but requires more skill to interpret. QQ plots are commonly used to compare a data set to a theoretical model. This can provide an assessment of \"goodness of fit\" that is graphical, rather than reducing to a numerical summary. QQ plots are also used to compare two theoretical distributions to each other. Since Q-Q plots compare distributions, there is no need for the values to be observed as pairs, as in a scatter plot, or even for the numbers of values in the two groups being compared to be equal.\n\n \n\n## Symetric distributions (https://en.wikipedia.org/wiki/Kurtosis)\n\nIn probability theory and statistics, kurtosis (from Greek: ????????????, kyrtos or kurtos, meaning \"curved, arching\") is a measure of the \"tailedness\" of the probability distribution of a real-valued random variable. In a similar way to the concept of skewness, kurtosis is a descriptor of the shape of a probability distribution and, just as for skewness, there are different ways of quantifying it for a theoretical distribution and corresponding ways of estimating it from a sample from a population. There are various interpretations of kurtosis, and of how particular measures should be interpreted; these are primarily tail weight, peakedness (width of peak), and lack of shoulders (distribution primarily peak and tails, not in between).\n\nThe standard measure of kurtosis, originating with Karl Pearson, is based on a scaled version of the fourth moment of the data or population. This number measures heavy tails, and not peakedness;hence, the \"peakedness\" definition is misleading. For this measure, higher kurtosis means more of the variance is the result of infrequent extreme deviations, as opposed to frequent modestly sized deviations.\n\nThe kurtosis of any univariate normal distribution is 3. It is common to compare the kurtosis of a distribution to this value. Distribution with kurtosis less than 3 are said to be __platykurtic__. An example of a platykurtic distribution is the uniform distribution, which does not have positive-valued tails. Distributions with kurtosis greater than 3 are said to be leptokurtic. An example of a leptokurtic distribution is the Laplace distribution, which has tails that asymptotically approach zero more slowly than a Gaussian. It is also common practice to use an adjusted version of Pearson's kurtosis, the excess kurtosis, which is the kurtosis minus 3, to provide the comparison to the normal distribution. Some authors useThe kurtosis of any univariate normal distribution is 3. It is common to compare the kurtosis of a distribution to this value. Distribution with kurtosis less than 3 are said to be __platykurtic__. An example of a platykurtic distribution is the uniform distribution, which does not have positive-valued tails. Distributions with kurtosis greater than 3 are said to be __leptokurtic__. An example of a leptokurtic distribution is the Laplace distribution, which has tails that asymptotically approach zero more slowly than a normal distributiion . It is also common practice to use an adjusted version of Pearson's kurtosis, the excess kurtosis, which is the kurtosis minus 3, to provide the comparison to the normal distribution. Some authors use \"kurtosis\" by itself to refer to the excess kurtosis. For the reason of clarity and generality, however, this articlepresentation follows the non-excess convention and explicitly indicates where excess kurtosis is meant.\n \"kurtosis\" by itself to refer to the excess kurtosis. For the reason of clarity and generality, however, this article follows the non-excess convention and explicitly indicates where excess kurtosis is meant.\n\n## Platykurtic  distribution\nA platykurtic distribution is one in which most of the values share about the same frequency of occurrence. As a result, the curve is very flat, or plateau-like.  A coin toss is an example of a particularity distribution because the $Pr(Head)=Pr(Tail)=\\frac{1}{2}$.\n\n```{r,echo=FALSE}\na <- 0\nb <- 100\nmu <- ( a + b )/2\nsigma <- sqrt((( b - a )^2)/12)\n\n```\n\n\nIn this document we will use a uniform random distribution with a mean of `r sprintf(\"%.2f\", mu  )` and a standard deviation of `r sprintf(\"%.2f\", sigma  )`.  The code below shows how to plot the theoretical density diagram, generate a random sample of size 500 from a continuous uniform distribution with limits 0 and 100, and the normal QQ plot of the sample.\n\n```{r,Uniform}\nrm( list=ls() )\nset.seed( 11 )\nsource( \"ggQQ.r\" )\nsource( \"multiplot.r \")\n\nrequire( ggplot2 )\n\n\nx <- c( 0, 100 )\ny <- c( 0.01, 0.01 )\nDF <- data.frame( x, y )\np1 <- \n    ggplot( DF,\n            aes(X, y)) +\n        scale_y_continuous(limits = c( 0, 0.015)) +\n        annotate( \"segment\", x=0.00, y=0.01, xend=100.00, yend=0.01 ) +\n        annotate( \"segment\", x=0.00, y=0.00, xend=0.00,   yend=0.01 ) +\n        annotate( \"segment\", x=100.00, y=0.00, xend=100.00, yend=0.01 ) +\n        xlab( \"X\" ) +\n        ylab( \"Density\" ) +\n        ggtitle(\"Theoretical Continuous Distribution\" ) +\n        theme_bw()\n\nx <- runif( 500, 0, 100 )\nDF <- data.frame( x )\n\np2 <- \n    ggplot( DF,\n            aes( x=x )) +\n    geom_histogram( aes( y=..density.. ),\n                    binwidth=10,\n                    color=\"black\",\n                    fill=\"white\"  ) +\n    geom_density( color=\"red\" ) +\n    xlab( \"X\" ) +\n    ylab( \"Density\" ) +\n    ggtitle( \"Example: Platykurtic Distribution: \\nContinuous UNiform Distribution\" )\n\np3 <- ggQQ( x )    \n    \nmultiplot( p1, p2, p3, cols=2)\n   \n```\n\nWe that the normal QQ plot looks like a elongated __S__.  The distribution has shorter tails than a normal distribution with the same standard deviations.  As a result the central theorem works well for relatively small samples sizes.  Empirical investigations shows that for sample sizes as low as 12 the resulting sampling distributions of the sample for uniform distributions is approximately normal distribution.\n\nIf you are working with platykurtic that are not uniform we expect that even small samples size 12 or larger will be approximately normally distributed. \nWe can always bootstrap the sample to evaluate the sampling distribution for normality.  \n\n## The Normal distribution\nIt can be shown that if we sample from a normal distribution that the sample points on a normal QQ plot should be approximately linear.  We know however that due to random sampling and other effects that there will be random variations around the theoretical expected line.  Also the points at the end of the line will have the greater variability so we can discount them. \n\nBelow we who the normal distribution with a mean of 50 and a standard devation of 28.87 to match our continuous uniform distribution.  As before, we draw the theoretical distribution, the histogram and the normal probability plots.  \n\n```{r}\nrm( list=ls())\nset.seed( 1123 )\nrequire( ggplot2)\nsource(\"ggQQ.r\")\nsource( \"multiplot.r \")\n\nmu <- 50\nsigma <- 28.87\n\nxl <- floor( mu - 4 * sigma )\nxh <- ceiling(  mu + 4 * sigma )\nx <- c( xl, xh )\nDF <- data.frame( x )\n\np1 <- ggplot( DF, \n              aes( x=x )) +\n        stat_function( fun=dnorm, args=list( mean=mu, sd=sigma) ) +\n     ylab( \"Desnisty\" ) +\n        ggtitle( expression(  X %~% N(50,28.87) ) )\n\nx <- rnorm( 500, mean=mu, sd=sigma )\nDF <- data.frame( x )\n\np2 <- \n    ggplot( DF,\n            aes( x=x )) +\n    geom_histogram( aes( y=..density.. ),\n                    binwidth=20,\n                    color=\"black\",\n                    fill=\"white\"  ) +\n    geom_density( color=\"red\" ) +\n    ylab( \"Density\" ) +\n    ggtitle( expression(X %~% N(50,28.87) ) )\n\np3 <- ggQQ( x )\n\nmultiplot( p1, p2, p3, cols=2)\n\n```\n\n## Deptokurtic distributions\nA distribution with positive excess kurtosis is called leptokurtic, or leptokurtotic. \"Lepto-\" means \"slender\". In terms of shape, a leptokurtic distribution has a more acute peak around the mean and fatter tails.  Student's t distribution is leptohurtic when the degrees fo freedom are small.  \n\nOur simulated sample will be drean from a students t-distribution with three degrees of freedom.  We will scale the distribution to have a mean of 50.00 and a standard deviation of 28.97.  we will also include a plot comparing the dormal distribution to the t distribution.\n\n```{r}\nrm( list=ls())\nrequire( ggplot2 )\nsource( \"ggQQ.r\" )\nsource( \"multiplot.r\")\n\nmu    <- 50\nsigma <- 28.97\nxmin <- -270\nxmax <- 370\nx <- seq( xmin, xmax, 0.50 )\nfz <- dnorm( ( x-mu ) / sigma  )\nft <- dt( ( x-mu ) / sigma, df=3 )\nf <- c( fz, ft )\nn <- length( fz )\nDistribution  <- c( rep( \"Normal\", n ),\n                    rep( \"Student's t\", n ))\nx <- rep( x, 2)\n\nDF <- data.frame( x, f, Distribution )\n\np1 <-\n    ggplot( DF,\n            aes( x=x, y=f, color=Distribution)) +\n    geom_line() +\n    ylab( \"Density \") +\n    ggtitle( \"Leptokurtic Distribution versus Normal Distribution\" )\n\nw <- mu + sigma * rt( 500, df=3 )\nDF <- data.frame( w )\n\np2 <-\n      ggplot( DF,\n              aes( x=w )) +\n        geom_histogram( aes( y=..density.. ),\n                        binwidth=20,\n                        color=\"black\", \n                        fill=\"white\" ) +\n    geom_density( color=\"red\" )\n\np3 <- ggQQ( w )\n\nmultiplot( p1, p2, p3, cols=2)\n\n```\n\n# Skewness\nIn this section we plot skewed data.  We will have both distributions with negative and positive skewness. \n\n## Negative skewness\n\n```{r}\nrm( list=ls())\nrequire( ggplot2 )\nsource(\"ggQQ.r\")\nsource( \"multiplot.r\" )\n\nalpha <- 1\nbeta  <- 10\n\nx <- c(0,1)\nDF <- data.frame( x )\n\np1 <-\n    ggplot( DF,\n        aes( x=x ))+\n    stat_function( fun=dbeta, \n                   args=list( shape1=9, shape=2 )) +\n    ylab( \"Density\" ) +\n    ggtitle( \"Negatively skewed distribution\" )\n\nx <- 100 * rbeta( 500, shape1=9, shape2=2  )\n\nDF <- data.frame( x )\n\np2 <- ggQQ( x )\n\nmultiplot( p1, p2, cols=2 )\n\n```\n\n\n## Positive skewness\n\n```{r}\nrm( list=ls())\nrequire( ggplot2 )\nsource(\"ggQQ.r\")\nsource( \"multiplot.r\" )\n\nalpha <- 2\nbeta  <- 10 \n\nx <- c(0,1)\nDF <- data.frame( x )\n\np1 <-\n    ggplot( DF,\n        aes( x=x ))+\n    stat_function( fun=dbeta, \n                   args=list( shape1=alpha, shape2=beta )) +\n    ylab( \"Density\" ) +\n    ggtitle( \"Positively skewed distribution\" )\n\nx <- rbeta( 500, shape1= alpha, shape2=beta )\n\nDF <- data.frame( x )\n\np2 <- \n    ggplot( DF,\n            aes( x= x)) +\n    geom_histogram( \n        aes( y=..density.. ),\n        binwidth=0.05,\n        color=\"black\",\n        fill=\"white\") +\n    geom_density( color=\"red\" ) \n\np3 <- ggQQ( x )\n\nmultiplot( p1, p2, p3, cols=2 )\n```\n\n# Practice\nThe rcode below provides a quick plot that will allow you to use graphics diagnose if a distribution is normally distributed.  It will also allow to specify the departures from normality,  \n\n```{r}\n\nlibrary( alr4 )\nsource( \"diagnose.r\")\n\ndata( BGSgirls)\nhead( BGSgirls)\n\nweight <- BGSgirls$WT2    #Girls weight at 2 years\ndiagnose( weight )\n\n```\n\n\n## Checking the appropriateness of the CLT\n```{r}\nlibrary( simpleboot )\nbootOut <- one.boot( weight,\n                     mean,\n                     R=10000 )\nsampleMean <- bootOut$t0\nbsMeans <- bootOut$t \nbsMean <- mean( bsMeans )\ndiagnose(bsMeans )\n\nboot.ci( bootOut, \n         conf=0.095,\n         type=c( \"norm\", \"bca\"))\n\n```\n\n## Texas Powerball Lottery Sales\nThe following data set is the sales of Texas Powerball Lottery Tickes per lottery Sale.  We will use the column that gives the saales in million oof dollars.\n\n```{r}\nrm( list=ls())\n\nTPS <- read.csv( \"TexasPoweball20132014X.csv\" )\nhead( TPS )\ntail( TPS )\nSalesM <- TPS$PBSalesM\ndiagnose( SalesM )\n\n```\n\nWe now proceed to diagnosse the distribution of the lottery occurence sales.  This is showb beliow:\n\n```{r}\nsource( \"diagnose.r\" )\nPBSalesM <- TPS$PBSalesM\ndiagnose( PBSalesM )\n\n```\n\n\nThis distributed has a very positice skey.  When a distribution is this skewed you should hire a consultant because it requires knowledge beyond what we teaxh in this course.  \n\n## Baseball batting performance\nThe Lahman package contails information of all MLB Baseball Players.  We are going to investigate all player that have plaid since the year 2000 and had at least 100 at bats.  We obtain the data as follows.  \n\n```{r}\nrm(list=ls())\n\n###########################################################\n# You only need to run this once. After it has been run   #\n# comment the statement so that you will not run again.   #\n###########################################################\n\ninstall.packages( \"Lahman\" )  # If you don't have it.\n\nrequire( Lahman )\ndata ( \"Batting\" )\nhead( Batting )\ntail( Batting )\nBatting <- Batting[ Batting$yearID >= 2000,]\nhead( Batting )\nBatting <- Batting[ Batting$AB > 100, ]\nBatting$OBP <- with( Batting, ( H + BB + HBP)/(AB + BB+ HBP) )\n\nsource( \"diagnose.r\")\ndiagnose(  Batting$OBP )\nrequire( nortest )\nad.test( Batting$OBP )\n\n############################################################\n# We need to find the batter with the highest OBP and then #\n# look up his name in the master table.                    #\n############################################################\ndata( Master )\nhead( Master )\ntail( Master )\n\nmaxOBP   <- max( Batting$OBP )\nplayerID <- Batting[ Batting$OBP == maxOBP, 1]\nMaster[Master$playerID == playerID, 14:15 ]\n\n``` \n\n\n\n\n\n\n\n\n",
    "created" : 1447788425729.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "4163566346",
    "id" : "9A5BD80E",
    "lastKnownWriteTime" : 1447792191,
    "path" : "C:/Users/Craig/BSTAT3322/Examples/ggQQNorm/Distributions.Rmd",
    "project_path" : "Distributions.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_markdown"
}